<!doctype html>
<html class="no-js" lang="zxx">
{%load static%}
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Checkout || Aboss eCommerce Bootstrap 4 Template</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Favicons -->
    <link rel="shortcut icon" href="{%static 'img/favicon.ico">
    <!-- Fontawesome css -->
    <link rel="stylesheet" href="{%static 'css/font-awesome.min.css' %}">
    <!-- Animate css -->
    <link rel="stylesheet" href="{%static 'css/animate.css' %}">
    <!-- Ionicons css -->
    <link rel="stylesheet" href="{%static 'css/ionicons.min.css' %}">
    <!-- Nice select css -->
    <link rel="stylesheet" href="{%static 'css/nice-select.css' %}">
    <!-- Jquery fancybox css -->
    <link rel="stylesheet" href="{%static 'css/jquery.fancybox.css' %}">
    <!-- Jquery ui price slider css -->
    <link rel="stylesheet" href="{%static 'css/jquery-ui.min.css' %}">
    <!-- Meanmenu css -->
    <link rel="stylesheet" href="{%static 'css/meanmenu.min.css' %}">
    <!-- Owl carousel css -->
    <link rel="stylesheet" href="{%static 'css/owl.carousel.min.css' %}">
    <!-- Bootstrap css -->
    <link rel="stylesheet" href="{%static 'css/bootstrap.min.css' %}">
    <!-- Custom css -->
    <link rel="stylesheet" href="{%static 'css/default.css' %}">
    <!-- Main css -->
    <link rel="stylesheet" href="{%static 'css/style.css' %}">
    <!-- Responsive css -->
    <link rel="stylesheet" href="{%static 'css/responsive.css' %}">
    <link rel="stylesheet" href="{%static 'css/custombutton.css' %}">

    <!-- Modernizer js -->
    <script src="{%static 'js/vendor/modernizr-3.5.0.min.js' %}"></script>
    <script src="https://www.paypal.com/sdk/js?client-id=AWijh9jZ_Qf516SosXhP2yhndm2CN5PmQAz3vXCB0Kob_AEiqhG-Ieeaffw9hTyBGV_6eRAcrYHrdNJD&currency=USD"></script>
</head>

<body>

<br>
<div class="checkout-area white-bg pb-40">
    <div class="container">
        <div class="row">
            <div class="col-lg-6 col-md-6">
                <div class="checkbox-form mb-sm-40">
                    <h3>Please fill your Billing Details</h3>
                    <form id="adress_form">
                        <div class="row">


                            <div class="col-md-12">
                                <div class="country-select clearfix mb-30">
                                    <label for="country">Country <span class="required">*</span></label>
                                    <input type="text" class="form-control" id="country" name="country" required>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="checkout-form-list mb-30">
                                    <label>Full Name <span class="required">*</span></label>
                                    <input type="text" placeholder="" id="name" name="name">
                                </div>
                            </div>

                            <div class="col-md-12">
                                <div class="checkout-form-list">
                                    <label>Address <span class="required">*</span></label>
                                    <input type="text" placeholder="Street address" id="address" name="address">
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="checkout-form-list mtb-30">
                                    <input type="text" placeholder="Apartment, suite, unit etc. (optional)"
                                           id="address2" name="address2">
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="checkout-form-list mb-30">
                                    <label>Town / City <span class="required">*</span></label>
                                    <input type="text" placeholder="Town / City" id="city" name="city">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="checkout-form-list mb-30">
                                    <label>State / County <span class="required">*</span></label>
                                    <input type="text" placeholder="" id="state" name="state">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="checkout-form-list mb-30">
                                    <label>Postcode / Zip <span class="required">*</span></label>
                                    <input type="text" placeholder="Postcode / Zip" id="zip" name="zip">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="checkout-form-list mb-30">
                                    <label>Email Address <span class="required">*</span></label>
                                    <input type="email" placeholder="" id="email" name="email">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="checkout-form-list mb-30">
                                    <label>Phone <span class="required">*</span></label>
                                    <input type="text" placeholder="Phone number with Country Code" id="phone"
                                           name="phone">
                                </div>
                            </div>
                            <div class="check-out">
                                    <button type="submit" class="check-button" >
                                        PROCEED FOR PAYMENT
                                    </button>
                                </div>


                        </div>
                    </form>
                </div>
            </div>

        </div>

    </div>


</div>
</body>

<!-- jquery 3.6.0 -->
<script src="{%static 'js/vendor/jquery-3.6.0.min.js' %}"></script>
<!-- Countdown js -->
<script src="{%static 'js/jquery.countdown.min.js' %}"></script>
<!-- Mobile menu js -->
<script src="{%static 'js/jquery.meanmenu.min.js' %}"></script>
<!-- ScrollUp js -->
<script src="{%static 'js/jquery.scrollUp.js' %}"></script>
<!-- Fancybox js -->
<script src="{%static 'js/jquery.fancybox.min.js' %}"></script>
<!-- Jquery nice select js -->
<script src="{%static 'js/jquery.nice-select.min.js' %}"></script>
<!-- Jquery ui price slider js -->
<script src="{%static 'js/jquery-ui.min.js' %}"></script>
<!-- Owl carousel -->
<script src="{%static 'js/owl.carousel.min.js' %}"></script>
<!-- Bootstrap popper js -->
<script src="{%static 'js/popper.min.js' %}"></script>
<!-- Bootstrap js -->
<script src="{%static 'js/bootstrap.min.js' %}"></script>
<!-- Plugin js -->
<script src="{%static 'js/plugins.js' %}"></script>
<!-- Main activaion js -->
<script src="{%static 'js/main.js' %}"></script>
<script>

 window.onload = function() {
         const deliveryForm = document.getElementById('adress_form');
         console.log(deliveryForm);

      // listen for form submission
        deliveryForm.addEventListener("submit", function(event) {
        event.preventDefault(); // prevent the form from submitting

        // get the form data
        const formData = new FormData(event.target);

        // convert the form data to an object
        const deliveryDetails = Object.fromEntries(formData.entries());


        // get the cart items from localStorage
        const cartItems = JSON.parse(localStorage.getItem("cartItems"));


        // create the data to send in the AJAX request

       console.log(deliveryDetails);
       console.log(cartItems);
         // send an AJAX request to the /payments/ URL
  $.ajax({
    url: "/payments/",
    type: "POST",
    data: JSON.stringify({cartItems: cartItems,deliveryDetails: deliveryDetails}),

headers: {
              'Content-Type': 'application/json',
              'X-CSRFToken': '{{ csrf_token }}',
            },
    success: function(response) {
      console.log(response); // log the response from the server
<!--      localStorage.removeItem("cartItems");-->
      localStorage.removeItem("deliveryDetails");// remove cartItems from localStorage


      var order_id = response.order_id;
      var total_price = response.total_price;
      var status = response.status;
       if ( status === 'success') {
        window.location.href = "/paymentmethod/?order_id=" + order_id ; // redirect to eSewa payment portal
      }else {
        window.location.href = "/checkout" ; // redirect to eSewa payment portal
      }

      },
    error: function(xhr, status, error) {
      console.error(error); // log any errors to the console
    },
  });
});
};




</script>


</html>
